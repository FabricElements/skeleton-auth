<link rel="import" href="../polymerfire/firebase-auth.html">

<!--
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<script>
  (function () {
    'use strict';

    /**
     * Base class that provides the core API for Polymer's meta-programming
     * features including template stamping, data-binding, attribute deserialization,
     * and property change observation.
     *
     * @polymerBehavior
     * @memberOf Fabric
     * @constructor
     * @summary Custom element base class that provides the core API for
     * @property google {boolean}
     */
    const AuthBehavior = function (superClass) {

      return class extends superClass {

        constructor() {
          super();
        }

        static get properties() {
          return {
            /**
             * Allow Google Sign-in.
             */
            google: {
              type: Boolean,
              notify: true,
              value: false
            },
            /**
             * Allow Facebook Sign-in.
             */
            facebook: {
              type: Boolean,
              notify: true,
              value: false
            },
            /**
             * Allow Twitter Sign-in.
             */
            twitter: {
              type: Boolean,
              notify: true,
              value: false
            },
            /**
             * Allow GitHub Sign-in.
             */
            github: {
              type: Boolean,
              notify: true,
              value: false
            },
            /**
             * Allow Email Sign-in.
             */
            email: {
              type: Boolean,
              notify: true,
              value: false
            },

            /**
             * Allow anonymous Sign-in.
             */
            anonymous: {
              type: Boolean,
              notify: true,
              value: false
            },

            /**
             * Error
             */
            error: {
              type: Object,
              notify: true,
              reflectToAttribute: true,
              value: null
            }
          }
        }

        static get observers() {
//          return ['_barChanged(hello)']
        }

        /**
         * Google Sign-in function.
         */
        signInGoogle() {
          var provider = new firebase.auth.GoogleAuthProvider();
          this._signIn(provider);
        }

        /**
         * Facebook Sign-in function.
         */
        signInFacebook() {
          var provider = new firebase.auth.FacebookAuthProvider();
          this._signIn(provider);
        }

        /**
         * Twitter Sign-in function.
         */
        signInTwitter() {
          var provider = new firebase.auth.TwitterAuthProvider();
          this._signIn(provider);
        }

        /**
         * GitHub Sign-in function.
         */
        signInGitHub() {
          var provider = new firebase.auth.GithubAuthProvider();
          this._signIn(provider);
        }

        /**
         * Anonymous Sign-in function.
         */
        signInAnonymously() {
          firebase.auth().signInAnonymously().then((result) => {
//            console.log("you are logged");
          }).catch((error) => {
            this.error = error;
          });
        }

        /**
         * Sign In the user.
         */
        _signIn(provider) {
          firebase.auth().signInWithPopup(provider).then((result) => {
            // This gives you a Google Access Token. You can use it to access the Google API.
            //var token = result.credential.accessToken;
            // The signed-in user info.
            //var user = result.user;
          }).catch((error) => {
            this.error = error;
          });
        }

        /**
         * Sign In with email and password.
         */
        signInWithEmailAndPassword(e) {
          if (e) {
            e.preventDefault();
          }
          firebase.auth().signInWithEmailAndPassword(this.email, this.password);
          this.email = null;
          this.password = null;
        }

        /**
         * Create user with email and password
         */
        createUserWithEmailAndPassword() {
          firebase.auth().createUserWithEmailAndPassword(this.email, this.password);
          this.email = null;
          this.password = null;
        }

        /**
         * sign out
         */
        signOut() {
          this.error = null;
          firebase.auth().signOut().then(() => {
//            console.log('Signed Out');
          }, (error) => {
            this.error = error;
          });
        }

      }
    };

    window.Fabric = window.Fabric || {};
    Fabric.AuthBehavior = AuthBehavior;
  })();
</script>
