<link rel="import" href="../polymerfire/firebase-auth-script.html">

<script>
  (() => {

    /**
     * Fabric.AuthMixin
     *
     * @polymerMixin
     * @memberOf Fabric
     * @constructor
     * @summary Custom element base class that provides the core API for
     * @property google {boolean}
     */
    const AuthMixin = (baseClass) => {

      return class extends baseClass {

        static get properties() {
          return {
            /**
             * Allow Google Sign-in.
             */
            google: {
              type: Boolean,
              notify: true,
              value: false
            },
            /**
             * Allow Facebook Sign-in.
             */
            facebook: {
              type: Boolean,
              notify: true,
              value: false
            },
            /**
             * Allow Twitter Sign-in.
             */
            twitter: {
              type: Boolean,
              notify: true,
              value: false
            },
            /**
             * Allow GitHub Sign-in.
             */
            github: {
              type: Boolean,
              notify: true,
              value: false
            },
            /**
             * Allow Email Sign-in.
             */
            email: {
              type: Boolean,
              notify: true,
              value: false
            },

            /**
             * Allow anonymous Sign-in.
             */
            anonymous: {
              type: Boolean,
              notify: true,
              value: false
            },

            /**
             * Error
             */
            error: {
              type: Object,
              notify: true,
              reflectToAttribute: true,
              value: null
            }
          };
        }

        static get observers() {
//          return ['_barChanged(hello)']
        }

        /**
         * Google Sign-in function.
         */
        signInGoogle() {
          const provider = new firebase.auth.GoogleAuthProvider();
          this._signIn(provider);
        }

        /**
         * Facebook Sign-in function.
         */
        signInFacebook() {
          const provider = new firebase.auth.FacebookAuthProvider();
          this._signIn(provider);
        }

        /**
         * Twitter Sign-in function.
         */
        signInTwitter() {
          const provider = new firebase.auth.TwitterAuthProvider();
          this._signIn(provider);
        }

        /**
         * GitHub Sign-in function.
         */
        signInGitHub() {
          const provider = new firebase.auth.GithubAuthProvider();
          this._signIn(provider);
        }

        /**
         * Anonymous Sign-in function.
         */
        signInAnonymously() {
          firebase.auth().signInAnonymously().catch(error => {
            this.error = error;
          });
        }

        /**
         * Sign In the user.
         */
        _signIn(provider) {
          firebase.auth().signInWithRedirect(provider).catch(error => {
            this.error = error;
          });
        }

        /**
         * Sign In with email and password.
         */
        signInWithEmailAndPassword(e) {
          if (e) {
            e.preventDefault();
          }
          firebase.auth().signInWithEmailAndPassword(this.email, this.password);
          this.email = null;
          this.password = null;
        }

        /**
         * Create user with email and password
         */
        createUserWithEmailAndPassword() {
          firebase.auth().createUserWithEmailAndPassword(this.email, this.password);
          this.email = null;
          this.password = null;
        }

        /**
         * sign out
         */
        signOut() {
          this.error = null;
          firebase.auth().signOut().catch(error => {
            this.error = error;
          });
        }

      };
    };

    window.Fabric = window.Fabric || {};
    Fabric.AuthMixin = AuthMixin;
  })();
</script>
